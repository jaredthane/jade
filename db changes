alter table receipts add column date datetime;
alter table entities add column client_accounts_group_id int(11);
alter table entities add column vendor_accounts_group_id int(11);
create table entries (id int(11) not null primary key auto_increment, post_id int(11), account_id int(11), balance decimal(8,2), created_at datetime);
alter table movements add column line_id int(11);
alter table orders add column purchase_receipt_number int(11);
alter table trans add column tipo varchar(255);
alter table trans add column is_payment tinyint(1);
update post_types set id = -1 where id=2;
alter table accounts add column balance decimal(8,2) default 0;
insert into entities (id, entity_type_id, name) values (9, 2, 'Anulado');
alter table orders change column purchase_receipt_number receipt_number int(11);
alter table orders add column next_order int(11);
alter table orders add column receipt_filename varchar(255);
update orders inner join receipts on receipts.order_id=orders.id set orders.receipt_number=receipts.number;
update orders inner join receipts on receipts.order_id=orders.id set orders.receipt_filename=receipts.filename;
alter table orders add column receipt_generated datetime;
alter table payments drop column receipt_id;
alter table orders change column receipt_number receipt_number char(8);
alter table entities change column next_receipt_number next_receipt_number char(8);
ALTER TABLE orders ADD INDEX(receipt_number);
ALTER TABLE orders ADD INDEX(created_at);
ALTER TABLE orders ADD INDEX(client_id);
ALTER TABLE orders ADD INDEX(vendor_id);
ALTER TABLE entries ADD INDEX(created_at);
ALTER TABLE payments ADD INDEX(created_at);
ALTER TABLE payments ADD INDEX(order_id);
ALTER TABLE payments ADD INDEX(created_at);
ALTER TABLE movements ADD INDEX(order_id);
ALTER TABLE movements ADD INDEX(product_id);
ALTER TABLE movements ADD INDEX(entity_id);
ALTER TABLE inventories ADD INDEX(product_id);
ALTER TABLE inventories ADD INDEX(entity_id);
alter table payments add column canceled datetime;
alter table trans add column payment_id int(11);
update trans set payment_id = order_id where is_payment;
update trans set order_id=null where is_payment ;
alter table trans drop column is_payment ;
alter table payments drop column receipt_id;
update accounts set modifier=-1 where id=10;
insert into rights (id, name) values (83, 'Crear Transacciones'),(84,'Cambiar Transacciones'),(85,'Ver Transacciones'),(86,'Borrar Transacciones');
alter table `lines` add column order_type_id int(11);
ALTER TABLE serialized_products ADD INDEX(product_id);
ALTER TABLE serialized_products ADD INDEX(serial_number);
alter table movements drop column oldline_id;
alter table movements drop column balance;
alter table movements drop column value;
alter table entities add column next_bar_code varchar(32);
alter table entities add column fax char(8);
alter table payments drop column amount;
update entities set cash_account_id=21 where id=4;
insert into rights (id, name) values (87, 'Procesar Cuentas Fisicas');
ALTER TABLE accounts ADD INDEX(parent_id);
ALTER TABLE accounts ADD INDEX(entity_id);
alter table accounts drop column postable;
alter table accounts drop column transparent_journal;
ALTER TABLE accounts ADD INDEX(name);
ALTER TABLE entities ADD INDEX(name);
ALTER TABLE entities ADD INDEX(entity_type_id);
ALTER TABLE entities ADD INDEX(site_id);
ALTER TABLE entries ADD INDEX(account_id);
ALTER TABLE entries ADD INDEX(post_id);
ALTER TABLE `lines` ADD INDEX(order_id);
ALTER TABLE `lines` ADD INDEX(product_id);

ALTER TABLE posts ADD INDEX(account_id);
ALTER TABLE posts ADD INDEX(trans_id);
ALTER TABLE posts ADD INDEX(created_at);

ALTER TABLE prices ADD INDEX(product_id);
ALTER TABLE prices ADD INDEX(price_group_id);

ALTER TABLE products ADD INDEX(name);
ALTER TABLE products ADD INDEX(vendor_id);
ALTER TABLE products ADD INDEX(upc);
ALTER TABLE products ADD INDEX(product_type_id);
ALTER TABLE products ADD INDEX(product_category_id);

ALTER TABLE rights_roles ADD INDEX(role_id);
ALTER TABLE roles_users ADD INDEX(user_id);

ALTER TABLE serialized_products ADD INDEX(product_id);
ALTER TABLE subscriptions ADD INDEX(client_id);
ALTER TABLE trans ADD INDEX(order_id);
ALTER TABLE trans ADD INDEX(created_at);
ALTER TABLE trans ADD INDEX(user_id);
ALTER TABLE users ADD INDEX(login);
ALTER TABLE warranties ADD INDEX(product_id);

ALTER TABLE entities ADD INDEX(created_at);
alter table orders change column next_order next_order_id int(11);

alter table trans add column direction int(2);
alter table accounts add column is_parent tinyint(1);
update accounts set is_parent = true;
update accounts left join (select parent_id id from accounts where parent_id is not null group by parent_id) as parents on parents.id=accounts.id set is_parent=0 where parents.id is null;
drop table entries;
# base_data is updated up to here
alter table trans change column tipo description varchar(32);
update accounts set modifier=1 where id=10;
